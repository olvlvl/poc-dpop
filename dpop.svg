<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1390px" preserveAspectRatio="none" style="width:1432px;height:1390px;background:#FFFFFF;" version="1.1" viewBox="0 0 1432 1390" width="1432px" zoomAndPan="magnify"><title>DPoP Authorization and Resource Access Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="334.8721" x="550.228" y="28.5352">DPoP Authorization and Resource Access Flow</text><rect fill="none" height="380.9688" style="stroke:#000000;stroke-width:1.5;" width="1011.0513" x="92" y="135.9766"/><rect fill="none" height="391.5898" style="stroke:#000000;stroke-width:1.5;" width="1404.3281" x="22" y="530.9453"/><rect fill="none" height="355.7266" style="stroke:#000000;stroke-width:1.5;" width="1306.3774" x="9" y="936.5352"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1190.2852" width="8" x="368.7524" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="372" x2="372" y1="118.9766" y2="1309.2617"/></g><g><title>Authorization Server .AS.</title><rect fill="#000000" fill-opacity="0.00000" height="1190.2852" width="8" x="639.5723" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="642.5811" x2="642.5811" y1="118.9766" y2="1309.2617"/></g><g><title>Resource Server .RS.</title><rect fill="#000000" fill-opacity="0.00000" height="1190.2852" width="8" x="836.4546" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="839.4663" x2="839.4663" y1="118.9766" y2="1309.2617"/></g><g class="participant participant-head" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="350" y="116.0234">Client</text><ellipse cx="372.7524" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M372.7524,58.9883 L372.7524,85.9883 M359.7524,66.9883 L385.7524,66.9883 M372.7524,85.9883 L359.7524,100.9883 M372.7524,85.9883 L385.7524,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="350" y="1321.7969">Client</text><ellipse cx="372.7524" cy="1333.25" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M372.7524,1341.25 L372.7524,1368.25 M359.7524,1349.25 L385.7524,1349.25 M372.7524,1368.25 L359.7524,1383.25 M372.7524,1368.25 L385.7524,1383.25" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="AS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.9824" x="551.5811" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.9824" x="558.5811" y="108.0234">Authorization Server (AS)</text></g><g class="participant participant-tail" data-participant="AS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.9824" x="551.5811" y="1308.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.9824" x="558.5811" y="1328.7969">Authorization Server (AS)</text></g><g class="participant participant-head" data-participant="RS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151.9766" x="764.4663" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.9766" x="771.4663" y="108.0234">Resource Server (RS)</text></g><g class="participant participant-tail" data-participant="RS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151.9766" x="764.4663" y="1308.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.9766" x="771.4663" y="1328.7969">Resource Server (RS)</text></g><path d="M92,135.9766 L241.2031,135.9766 L241.2031,143.2871 L231.2031,153.2871 L92,153.2871 L92,135.9766" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="380.9688" style="stroke:#000000;stroke-width:1.5;" width="1011.0513" x="92" y="135.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="104.2031" x="107" y="149.5449">Token Issuance</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="174.5977" y2="174.5977"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="174.5977" y2="187.5977"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="187.5977" y2="187.5977"/><polygon fill="#181818" points="383.7524,183.5977,373.7524,187.5977,383.7524,191.5977,379.7524,187.5977" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.7339" x="379.7524" y="169.8555">Generate DPoP Key Pair (if none exists)</text></g><path d="M635.7339,161.7871 L635.7339,186.7871 L825.7339,186.7871 L825.7339,171.7871 L815.7339,161.7871 L635.7339,161.7871" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M815.7339,161.7871 L815.7339,171.7871 L825.7339,171.7871 L815.7339,161.7871" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.2476" x="641.7339" y="179.3555">Manages key in IndexedDB</text><g class="message" data-participant-1="C" data-participant-2="AS"><polygon fill="#181818" points="631.5723,246.5293,641.5723,250.5293,631.5723,254.5293,635.5723,250.5293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="637.5723" y1="250.5293" y2="250.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.1934" x="379.7524" y="230.4766">POST /token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.7354" x="379.7524" y="245.7871">(with DPoP Proof)</text></g><path d="M208,200.5977 L208,271.5977 L367,271.5977 L367,210.5977 L357,200.5977 L208,200.5977" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,200.5977 L357,210.5977 L367,210.5977 L357,200.5977" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.2456" x="214" y="218.166">DPoP Proof includes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.0176" x="214" y="233.4766">- Public Key (jwk)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.147" x="214" y="248.7871">- htm: "POST"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.4854" x="214" y="264.0977">- htu: ".../token"</text><g class="message" data-participant-1="AS" data-participant-2="AS"><line style="stroke:#181818;stroke-width:1;" x1="643.5723" x2="685.5723" y1="302.3057" y2="302.3057"/><line style="stroke:#181818;stroke-width:1;" x1="685.5723" x2="685.5723" y1="302.3057" y2="315.3057"/><line style="stroke:#181818;stroke-width:1;" x1="644.5723" x2="685.5723" y1="315.3057" y2="315.3057"/><polygon fill="#181818" points="654.5723,311.3057,644.5723,315.3057,654.5723,319.3057,650.5723,315.3057" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2363" x="650.5723" y="297.5635">Validate DPoP Proof</text></g><path d="M786.2363,281.8398 L786.2363,321.8398 L974.2363,321.8398 L974.2363,291.8398 L964.2363,281.8398 L786.2363,281.8398" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M964.2363,281.8398 L964.2363,291.8398 L974.2363,291.8398 L964.2363,281.8398" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.8701" x="792.2363" y="299.4082">- Verify signature with jwk</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.4292" x="792.2363" y="314.7188">- Check htm, htu, iat, jti</text><g class="message" data-participant-1="AS" data-participant-2="AS"><line style="stroke:#181818;stroke-width:1;" x1="643.5723" x2="685.5723" y1="360.582" y2="360.582"/><line style="stroke:#181818;stroke-width:1;" x1="685.5723" x2="685.5723" y1="360.582" y2="373.582"/><line style="stroke:#181818;stroke-width:1;" x1="644.5723" x2="685.5723" y1="373.582" y2="373.582"/><polygon fill="#181818" points="654.5723,369.582,644.5723,373.582,654.5723,377.582,650.5723,373.582" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.8823" x="650.5723" y="355.8398">Generate DPoP Access Token</text></g><path d="M844.8823,332.4609 L844.8823,387.4609 L1086.8823,387.4609 L1086.8823,342.4609 L1076.8823,332.4609 L844.8823,332.4609" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1076.8823,332.4609 L1076.8823,342.4609 L1086.8823,342.4609 L1076.8823,332.4609" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.0225" x="850.8823" y="350.0293">- Create JWT with claims</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.4463" x="850.8823" y="365.3398">- Add 'cnf' claim with 'jkt'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.3701" x="859.1089" y="380.6504">(thumbprint of client's public key)</text><g class="message" data-participant-1="AS" data-participant-2="C"><polygon fill="#181818" points="383.7524,444.3242,373.7524,448.3242,383.7524,452.3242,379.7524,448.3242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="377.7524" x2="642.5723" y1="448.3242" y2="448.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.3599" x="389.7524" y="428.2715">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.2007" x="389.7524" y="443.582">(Access Token + DPoP-Nonce)</text></g><path d="M102,398.3926 L102,469.3926 L367,469.3926 L367,408.3926 L357,398.3926 L102,398.3926" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,398.3926 L357,408.3926 L367,408.3926 L357,398.3926" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127.8862" x="108" y="415.9609">Response includes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.0029" x="108" y="431.2715">- token_type: "DPoP"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.2974" x="108" y="446.582">- access_token: (JWT with jkt)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.2705" x="108" y="461.8926">- DPoP-Nonce header for next request</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="495.9453" y2="495.9453"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="495.9453" y2="508.9453"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="508.9453" y2="508.9453"/><polygon fill="#181818" points="383.7524,504.9453,373.7524,508.9453,383.7524,512.9453,379.7524,508.9453" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.8198" x="379.7524" y="491.2031">Store Access Token &amp; Add Nonce to Pool</text></g><path d="M22,530.9453 L425.2744,530.9453 L425.2744,538.2559 L415.2744,548.2559 L22,548.2559 L22,530.9453" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="391.5898" style="stroke:#000000;stroke-width:1.5;" width="1404.3281" x="22" y="530.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="358.2744" x="37" y="544.5137">Resource Access (Happy Path - with proactive nonce)</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="569.5664" y2="569.5664"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="569.5664" y2="582.5664"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="582.5664" y2="582.5664"/><polygon fill="#181818" points="383.7524,578.5664,373.7524,582.5664,383.7524,586.5664,379.7524,582.5664" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.5332" x="379.7524" y="564.8242">Get Nonce from Pool</text></g><g class="message" data-participant-1="C" data-participant-2="RS"><polygon fill="#181818" points="828.4546,672.1191,838.4546,676.1191,828.4546,680.1191,832.4546,676.1191" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="834.4546" y1="676.1191" y2="676.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0542" x="379.7524" y="656.0664">GET /resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.8125" x="379.7524" y="671.377">(Authorization + DPoP Proof)</text></g><path d="M100,595.5664 L100,727.5664 L367,727.5664 L367,605.5664 L357,595.5664 L100,595.5664" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,595.5664 L357,605.5664 L367,605.5664 L357,595.5664" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111.0713" x="106" y="613.1348">Headers include:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.3208" x="106" y="628.4453">- Authorization: DPoP &lt;access_token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.103" x="106" y="643.7559">- DPoP: (new proof)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="106" y="659.0664">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.2456" x="106" y="674.377">DPoP Proof includes:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7227" x="106" y="689.6875">- jwk, htm, htu</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.6177" x="106" y="704.998">- ath: hash(access_token)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.5845" x="106" y="720.3086">- nonce: (from pool)</text><g class="message" data-participant-1="RS" data-participant-2="RS"><line style="stroke:#181818;stroke-width:1;" x1="840.4546" x2="882.4546" y1="789.1377" y2="789.1377"/><line style="stroke:#181818;stroke-width:1;" x1="882.4546" x2="882.4546" y1="789.1377" y2="802.1377"/><line style="stroke:#181818;stroke-width:1;" x1="841.4546" x2="882.4546" y1="802.1377" y2="802.1377"/><polygon fill="#181818" points="851.4546,798.1377,841.4546,802.1377,851.4546,806.1377,847.4546,802.1377" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.5381" x="847.4546" y="784.3955">Validate Access Token &amp; DPoP Proof</text></g><path d="M1086.5381,738.0508 L1086.5381,839.0508 L1410.5381,839.0508 L1410.5381,748.0508 L1400.5381,738.0508 L1086.5381,738.0508" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1400.5381,738.0508 L1400.5381,748.0508 L1410.5381,748.0508 L1400.5381,738.0508" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.5747" x="1092.5381" y="755.6191">1. Validate Access Token signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.2881" x="1092.5381" y="770.9297">2. Extract 'jkt' from Access Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303.3354" x="1092.5381" y="786.2402">3. Validate DPoP Proof (signature, htm, htu, ath)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.9429" x="1092.5381" y="801.5508">4. Validate nonce from proof</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.3335" x="1092.5381" y="816.8613">5.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100.0581" x="1108.9849" y="816.8613">Token Binding:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.7266" x="1213.1563" y="816.8613">Compare 'jkt' from token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.7178" x="1104.8779" y="832.1719">with 'jkt' computed from proof's jwk.</text><g class="message" data-participant-1="RS" data-participant-2="C"><polygon fill="#181818" points="383.7524,865.2246,373.7524,869.2246,383.7524,873.2246,379.7524,869.2246" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="377.7524" x2="839.4546" y1="869.2246" y2="869.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.0981" x="389.7524" y="864.4824">200 OK (Resource Data + DPoP-Nonce)</text></g><path d="M32,849.9141 L32,874.9141 L367,874.9141 L367,859.9141 L357,849.9141 L32,849.9141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,849.9141 L357,859.9141 L367,859.9141 L357,849.9141" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314.374" x="38" y="867.4824">Server provides a new nonce for the next request.</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="901.5352" y2="901.5352"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="901.5352" y2="914.5352"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="914.5352" y2="914.5352"/><polygon fill="#181818" points="383.7524,910.5352,373.7524,914.5352,383.7524,918.5352,379.7524,914.5352" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.4341" x="379.7524" y="896.793">Add new Nonce to Pool</text></g><path d="M9,936.5352 L351.7686,936.5352 L351.7686,943.8457 L341.7686,953.8457 L9,953.8457 L9,936.5352" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="355.7266" style="stroke:#000000;stroke-width:1.5;" width="1306.3774" x="9" y="936.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="297.7686" x="24" y="950.1035">Resource Access (Challenge-Response Path)</text><g class="message" data-participant-1="C" data-participant-2="RS"><polygon fill="#181818" points="828.4546,986.4668,838.4546,990.4668,828.4546,994.4668,832.4546,990.4668" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="834.4546" y1="990.4668" y2="990.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0542" x="379.7524" y="970.4141">GET /resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.8809" x="379.7524" y="985.7246">(Authorization + DPoP Proof w/o nonce)</text></g><path d="M150,963.501 L150,988.501 L367,988.501 L367,973.501 L357,963.501 L150,963.501" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,963.501 L357,973.501 L367,973.501 L357,963.501" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.4092" x="156" y="981.0693">Client has no nonce in its pool.</text><g class="message" data-participant-1="RS" data-participant-2="RS"><line style="stroke:#181818;stroke-width:1;" x1="840.4546" x2="882.4546" y1="1019.7773" y2="1019.7773"/><line style="stroke:#181818;stroke-width:1;" x1="882.4546" x2="882.4546" y1="1019.7773" y2="1032.7773"/><line style="stroke:#181818;stroke-width:1;" x1="841.4546" x2="882.4546" y1="1032.7773" y2="1032.7773"/><polygon fill="#181818" points="851.4546,1028.7773,841.4546,1032.7773,851.4546,1036.7773,847.4546,1032.7773" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2363" x="847.4546" y="1015.0352">Validate DPoP Proof</text></g><path d="M983.2363,1006.9668 L983.2363,1031.9668 L1299.2363,1031.9668 L1299.2363,1016.9668 L1289.2363,1006.9668 L983.2363,1006.9668" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1289.2363,1006.9668 L1289.2363,1016.9668 L1299.2363,1016.9668 L1289.2363,1006.9668" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295.6865" x="989.2363" y="1024.5352">Validation fails: Nonce is required but missing.</text><g class="message" data-participant-1="RS" data-participant-2="C"><polygon fill="#181818" points="383.7524,1073.3984,373.7524,1077.3984,383.7524,1081.3984,379.7524,1077.3984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="377.7524" x2="839.4546" y1="1077.3984" y2="1077.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.9658" x="389.7524" y="1057.3457">401 Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.6411" x="389.7524" y="1072.6563">(with DPoP-Nonce challenge)</text></g><path d="M172,1050.4326 L172,1075.4326 L367,1075.4326 L367,1060.4326 L357,1050.4326 L172,1050.4326" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,1050.4326 L357,1060.4326 L367,1060.4326 L357,1050.4326" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.5225" x="178" y="1068.001">This is the "reactive" nonce.</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="1106.709" y2="1106.709"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="1106.709" y2="1119.709"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="1119.709" y2="1119.709"/><polygon fill="#181818" points="383.7524,1115.709,373.7524,1119.709,383.7524,1123.709,379.7524,1119.709" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.7002" x="379.7524" y="1101.9668">Create new DPoP proof for retry</text></g><path d="M591.7002,1093.8984 L591.7002,1118.8984 L1068.7002,1118.8984 L1068.7002,1103.8984 L1058.7002,1093.8984 L591.7002,1093.8984" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1058.7002,1093.8984 L1058.7002,1103.8984 L1068.7002,1103.8984 L1058.7002,1093.8984" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="456.187" x="597.7002" y="1111.4668">Uses the specific nonce from the 401 challenge. This bypasses the pool.</text><g class="message" data-participant-1="C" data-participant-2="RS"><polygon fill="#181818" points="828.4546,1160.3301,838.4546,1164.3301,828.4546,1168.3301,832.4546,1164.3301" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="834.4546" y1="1164.3301" y2="1164.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.0542" x="379.7524" y="1144.2773">GET /resource</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.2529" x="379.7524" y="1159.5879">(Authorization + new DPoP Proof)</text></g><path d="M70,1137.3643 L70,1162.3643 L367,1162.3643 L367,1147.3643 L357,1137.3643 L70,1137.3643" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M357,1137.3643 L357,1147.3643 L367,1147.3643 L357,1137.3643" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.5293" x="76" y="1154.9326">Request is retried with the challenge nonce.</text><g class="message" data-participant-1="RS" data-participant-2="RS"><line style="stroke:#181818;stroke-width:1;" x1="840.4546" x2="882.4546" y1="1193.6406" y2="1193.6406"/><line style="stroke:#181818;stroke-width:1;" x1="882.4546" x2="882.4546" y1="1193.6406" y2="1206.6406"/><line style="stroke:#181818;stroke-width:1;" x1="841.4546" x2="882.4546" y1="1206.6406" y2="1206.6406"/><polygon fill="#181818" points="851.4546,1202.6406,841.4546,1206.6406,851.4546,1210.6406,847.4546,1206.6406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.9912" x="847.4546" y="1188.8984">Re-validate proof (now with correct nonce)</text></g><path d="M1128.9912,1180.8301 L1128.9912,1205.8301 L1277.9912,1205.8301 L1277.9912,1190.8301 L1267.9912,1180.8301 L1128.9912,1180.8301" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1267.9912,1180.8301 L1267.9912,1190.8301 L1277.9912,1190.8301 L1267.9912,1180.8301" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.7622" x="1134.9912" y="1198.3984">Validation succeeds.</text><g class="message" data-participant-1="RS" data-participant-2="C"><polygon fill="#181818" points="383.7524,1234.9512,373.7524,1238.9512,383.7524,1242.9512,379.7524,1238.9512" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="377.7524" x2="839.4546" y1="1238.9512" y2="1238.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.0981" x="389.7524" y="1234.209">200 OK (Resource Data + DPoP-Nonce)</text></g><path d="M19,1219.6406 L19,1244.6406 L366,1244.6406 L366,1229.6406 L356,1219.6406 L19,1219.6406" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M356,1219.6406 L356,1229.6406 L366,1229.6406 L356,1219.6406" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326.9043" x="25" y="1237.209">Server provides a new nonce for the *next* request.</text><g class="message" data-participant-1="C" data-participant-2="C"><line style="stroke:#181818;stroke-width:1;" x1="372.7524" x2="414.7524" y1="1271.2617" y2="1271.2617"/><line style="stroke:#181818;stroke-width:1;" x1="414.7524" x2="414.7524" y1="1271.2617" y2="1284.2617"/><line style="stroke:#181818;stroke-width:1;" x1="373.7524" x2="414.7524" y1="1284.2617" y2="1284.2617"/><polygon fill="#181818" points="383.7524,1280.2617,373.7524,1284.2617,383.7524,1288.2617,379.7524,1284.2617" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.4341" x="379.7524" y="1266.5195">Add new Nonce to Pool</text></g><!--SRC=[lLLDSzis4BthL-peKD6An3WVlN0wcL7aV3IP9XhHII-ToS3aKeH50Im0MbP_VHS0FsKfTNE8nXU3Yzstx-t36cuAXAkLNC6YChbK_1zck1J0H0fhrB9I2S8YIL1hU5l8_MZ44YCLB0kEmW3Ji1oLJ1cUy9BHmNYO9aPrXmg2HNmnji6BU1ZTbcW2rtNWEXwDDafM9LpBBGhuNUkAYGH7GBybp5_1Ce9tA50nKpVm4G-mOfoIy0o450XupxNH5-wEa1Id-2Ot4Vp11DkWXYtTu9HRf7YFwTNhKPTz4KUm-XnVmrDZw_ybWZqtkI-qKb9clQm5PiRz1p2TTX6KEYcg57KqdTQVvx2gRWgUEAp1xNvxqNx8pIw2iIqvxfrLT1Q6eGVXFo0fOyjwi8kuGVkL5JnjoN08ZXeVrMc_ekBP0JJV26OgXU1Q8pHDm3B7P6iHpIo46N1cPd1h-7Vh3yMeHyQ9TmR6Kg4D__3djGUG58plTFDraQOmIKGsyUS-P7AxDPEQ7WXCNkrkIiLfa8Zjn4taH4FfAIPnByu2fk5vVda9dp-Ii7seyCJ1dt-ID6ld9AQXBQNGU59WfzGtSoYHfBEvEZcPA_JDHKGGj8rJKzqSTEKXHvQI9pAocy1x0mh_hb2R4qqrXeZ9cZZW7dvnJFg4Hi9Aoc94bnjt7NiyUC_Aqlg8SCqzl599yZo_GskgXfNEWgPEdYcvy-dRxsix5c_8GwgkOjaUl0zF7k6ezuu6tR3T9tkGBFAvVklJ_6h0Av4kS6yRijKUQraongmrGoUcoIF8cSw3VhrEHySL5NIqb4JBgM5SnmrDhNkFnFiFCyEpyCpLrjrruFCGtjmRHKfw5tcz7jWKu4LuwYc1e4quwxqCn4BJyilUFT5DHDbY1_Wr9BOzlDTSf5niY6TOoXtj1Ep3CZqyzEky3ma5LmRJNdAoF4aKdgMtzJfjbsRQhvXXt_Dwr2magd37QI20WHsTkZ5ofCbnuCfmw4HhEdlXySPRvgmeK6nmthulgvRU7x0Jx9_AlcDxlTNBcwQNJkkUQ0zoezsaXcU7y-mqjZ4MHSPueQEwTQuTGroHPZULWHtNceGFZnHwUVaClWXMTuDfV-7Mps7I4FIWd-kSgj2VrMHCMyMzLcFVs94kzTAnqhXct0GvGHKQTNZGrXUDFgykCU4PxPNURDjp2xn55deeDuUIwUPYZz57gzZ2E_KmHZGxRkGyjqPnejQHPSkrM0RjTrgkSNxNoEcR3uJSrnjOAeNqG1nFpKE9TKLJYwaEVuxHfjPfq_zjjNy1]--></g></svg>