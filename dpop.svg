<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1242px" preserveAspectRatio="none" style="width:1441px;height:1242px;background:#FFFFFF;" version="1.1" viewBox="0 0 1441 1242" width="1441px" zoomAndPan="magnify"><title>DPoP Proof Generation and Challenge-Response Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="387.8232" x="522.8706" y="28.5352">DPoP Proof Generation and Challenge-Response Flow</text><rect fill="#FFFFE0" height="1192.6035" style="stroke:#181818;stroke-width:0.5;" width="175.4126" x="839.0532" y="43.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="169.4126" x="842.0532" y="56.0566">Authorization Server (AS)</text><rect fill="#ADD8E6" height="1192.6035" style="stroke:#181818;stroke-width:0.5;" width="144.2471" x="1016.4658" y="43.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="138.0171" x="1019.5808" y="56.0566">Resource Server (RS)</text><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="352.1504"/></g><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="654.9453"/></g><g><title>Client</title><rect fill="#FFFFFF" height="229.1738" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="918.4297"/></g><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="27.7524" y="1109.293"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="193.5977"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="171.5527" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="454.082"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="756.877"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="950.7402"/></g><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1037.627" width="8" x="23.7524" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="27" x2="27" y1="118.9766" y2="1156.6035"/></g><g><title>..Local Instance..</title><rect fill="#000000" fill-opacity="0.00000" height="1037.627" width="8" x="491.3193" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="495.02" x2="495.02" y1="118.9766" y2="1156.6035"/></g><g><title>TokenEndpoint</title><rect fill="#000000" fill-opacity="0.00000" height="1037.627" width="8" x="922.7595" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="926.4626" x2="926.4626" y1="118.9766" y2="1156.6035"/></g><g><title>ResourceEndpoint</title><rect fill="#000000" fill-opacity="0.00000" height="1037.627" width="8" x="1084.5894" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1088.4658" x2="1088.4658" y1="118.9766" y2="1156.6035"/></g><g class="participant participant-head" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="116.0234">Client</text><ellipse cx="27.7524" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,58.9883 L27.7524,85.9883 M14.7524,66.9883 L40.7524,66.9883 M27.7524,85.9883 L14.7524,100.9883 M27.7524,85.9883 L40.7524,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="C"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="1169.1387">Client</text><ellipse cx="27.7524" cy="1180.5918" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,1188.5918 L27.7524,1215.5918 M14.7524,1196.5918 L40.7524,1196.5918 M27.7524,1215.5918 L14.7524,1230.5918 M27.7524,1215.5918 L40.7524,1230.5918" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="S"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5986" x="433.02" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="110.5986" x="440.02" y="91.5352">&#171;Local Instance&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.0957" x="456.7715" y="108.0234">DPoPSigner</text></g><g class="participant participant-tail" data-participant="S"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.5986" x="433.02" y="1155.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="110.5986" x="440.02" y="1176.1387">&#171;Local Instance&#187;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.0957" x="456.7715" y="1192.627">DPoPSigner</text></g><g class="participant participant-head" data-participant="AS_Token"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.5938" x="868.4626" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.5938" x="875.4626" y="108.0234">TokenEndpoint</text></g><g class="participant participant-tail" data-participant="AS_Token"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116.5938" x="868.4626" y="1155.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102.5938" x="875.4626" y="1176.1387">TokenEndpoint</text></g><g class="participant participant-head" data-participant="RS_Res"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.2471" x="1020.4658" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.2471" x="1027.4658" y="108.0234">ResourceEndpoint</text></g><g class="participant participant-tail" data-participant="RS_Res"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.2471" x="1020.4658" y="1155.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.2471" x="1027.4658" y="1176.1387">ResourceEndpoint</text></g><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="352.1504"/></g><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="654.9453"/></g><g><title>Client</title><rect fill="#FFFFFF" height="229.1738" style="stroke:#181818;stroke-width:1;" width="10" x="22.7524" y="918.4297"/></g><g><title>Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="27.7524" y="1109.293"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="193.5977"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="171.5527" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="454.082"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="756.877"/></g><g><title>..Local Instance..</title><rect fill="#FFFFFF" height="129.2422" style="stroke:#181818;stroke-width:1;" width="10" x="490.3193" y="950.7402"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1434.5645" x="0" y="149.6318"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="149.6318" y2="149.6318"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="152.6318" y2="152.6318"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="261.5903" x="586.4871" y="138.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="243.3057" x="592.4871" y="155.5449">Token Acquisition (No 'ath' in Proof)</text><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="478.3193,189.5977,488.3193,193.5977,478.3193,197.5977,482.3193,193.5977" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="484.3193" y1="193.5977" y2="193.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="34.7524" y="188.8555">T1.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.9951" x="67.5264" y="188.8555">signProof(URL_TOKEN, POST, null)</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="222.9082" y2="222.9082"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="222.9082" y2="235.9082"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="235.9082" y2="235.9082"/><polygon fill="#181818" points="511.3193,231.9082,501.3193,235.9082,511.3193,239.9082,507.3193,235.9082" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="507.3193" y="218.166">T2.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234.5396" x="540.0933" y="218.166">provideKey() (Get/Generate DPoPKey)</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="265.2188" y2="265.2188"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="265.2188" y2="278.2188"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="278.2188" y2="278.2188"/><polygon fill="#181818" points="511.3193,274.2188,501.3193,278.2188,511.3193,282.2188,507.3193,278.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="507.3193" y="260.4766">T3.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337.3271" x="540.0933" y="260.4766">createDPoPProof() (Gen JWT, Sign, 'ath' claim missing)</text></g><g class="message" data-participant-1="C" data-participant-2="AS_Token"><polygon fill="#181818" points="914.7595,318.8398,924.7595,322.8398,914.7595,326.8398,918.7595,322.8398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="920.7595" y1="322.8398" y2="322.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="34.7524" y="310.4424">T4.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274.7266" x="67.5264" y="302.7871">POST /token (Authorization: DPoP &lt;token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.4678" x="67.5264" y="318.0977">DPoP: &lt;proof&gt;)</text></g><g class="message" data-participant-1="AS_Token" data-participant-2="C"><polygon fill="#181818" points="43.7524,348.1504,33.7524,352.1504,43.7524,356.1504,39.7524,352.1504" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.7524" x2="925.7595" y1="352.1504" y2="352.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="49.7524" y="347.4082">T5.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297.4956" x="82.5264" y="347.4082">200 OK (access_token, DPoP-Nonce: &lt;nonce&gt;)</text></g><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="483.3193,377.4609,493.3193,381.4609,483.3193,385.4609,487.3193,381.4609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="489.3193" y1="381.4609" y2="381.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28.7739" x="34.7524" y="376.7188">T6.0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="405.793" x="67.5264" y="376.7188">setOneShotNonce(&lt;nonce&gt;) // Proactive nonce for next request</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1434.5645" x="0" y="410.1162"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="410.1162" y2="410.1162"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="413.1162" y2="413.1162"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="377.9111" x="528.3267" y="399.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="359.6265" x="534.3267" y="416.0293">Protected Resource Access (Success/Proactive Nonce)</text><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="478.3193,450.082,488.3193,454.082,478.3193,458.082,482.3193,454.082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="484.3193" y1="454.082" y2="454.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="449.3398">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.7339" x="47.3281" y="449.3398">signProof(URL_RES, GET, &lt;token&gt;)</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="483.3926" y2="483.3926"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="483.3926" y2="496.3926"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="496.3926" y2="496.3926"/><polygon fill="#181818" points="511.3193,492.3926,501.3193,496.3926,511.3193,500.3926,507.3193,496.3926" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="507.3193" y="478.6504">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.6919" x="519.895" y="478.6504">retrieveKey()</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="525.7031" y2="525.7031"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="525.7031" y2="538.7031"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="538.7031" y2="538.7031"/><polygon fill="#181818" points="511.3193,534.7031,501.3193,538.7031,511.3193,542.7031,507.3193,538.7031" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="507.3193" y="520.9609">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316.5068" x="519.895" y="520.9609">retrieveOneShotNonce() // Consume stored nonce</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="568.0137" y2="568.0137"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="568.0137" y2="581.0137"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="581.0137" y2="581.0137"/><polygon fill="#181818" points="511.3193,577.0137,501.3193,581.0137,511.3193,585.0137,507.3193,581.0137" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="507.3193" y="563.2715">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.4551" x="519.895" y="563.2715">createDPoPProof() (Gen JWT, Sign, 'ath' &amp; 'nonce' present)</text></g><g class="message" data-participant-1="C" data-participant-2="RS_Res"><polygon fill="#181818" points="1076.5894,621.6348,1086.5894,625.6348,1076.5894,629.6348,1080.5894,625.6348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="1082.5894" y1="625.6348" y2="625.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="613.2373">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.5874" x="47.3281" y="605.582">GET /resource (Authorization: DPoP &lt;token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.4214" x="47.3281" y="620.8926">DPoP: &lt;proof with nonce&gt;)</text></g><g class="message" data-participant-1="RS_Res" data-participant-2="C"><polygon fill="#181818" points="43.7524,650.9453,33.7524,654.9453,43.7524,658.9453,39.7524,654.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.7524" x2="1087.5894" y1="654.9453" y2="654.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="49.7524" y="650.2031">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.3599" x="62.3281" y="650.2031">200 OK</text></g><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="483.3193,680.2559,493.3193,684.2559,483.3193,688.2559,487.3193,684.2559" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="489.3193" y1="684.2559" y2="684.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="679.5137">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.8413" x="47.3281" y="679.5137">setNonce(htu, nonce) // Store new nonce</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1434.5645" x="0" y="712.9111"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="712.9111" y2="712.9111"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1434.5645" y1="715.9111" y2="715.9111"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="320.1538" x="557.2053" y="702.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="301.8691" x="563.2053" y="718.8242">Protected Resource Access (Challenge/Retry)</text><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="478.3193,752.877,488.3193,756.877,478.3193,760.877,482.3193,756.877" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="484.3193" y1="756.877" y2="756.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="752.1348">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.7339" x="47.3281" y="752.1348">signProof(URL_RES, GET, &lt;token&gt;)</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="786.1875" y2="786.1875"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="786.1875" y2="799.1875"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="799.1875" y2="799.1875"/><polygon fill="#181818" points="511.3193,795.1875,501.3193,799.1875,511.3193,803.1875,507.3193,799.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="507.3193" y="781.4453">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.6919" x="519.895" y="781.4453">retrieveKey()</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="828.498" y2="828.498"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="828.498" y2="841.498"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="841.498" y2="841.498"/><polygon fill="#181818" points="511.3193,837.498,501.3193,841.498,511.3193,845.498,507.3193,841.498" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="507.3193" y="823.7559">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.6509" x="528.4707" y="823.7559">createDPoPProof() ('nonce' claim missing)</text></g><g class="message" data-participant-1="C" data-participant-2="RS_Res"><polygon fill="#181818" points="1076.5894,882.1191,1086.5894,886.1191,1076.5894,890.1191,1080.5894,886.1191" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="1082.5894" y1="886.1191" y2="886.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="34.7524" y="873.7217">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.5874" x="55.9038" y="866.0664">GET /resource (Authorization: DPoP &lt;token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.4678" x="55.9038" y="881.377">DPoP: &lt;proof&gt;)</text></g><g class="message" data-participant-1="RS_Res" data-participant-2="C"><polygon fill="#181818" points="43.7524,914.4297,33.7524,918.4297,43.7524,922.4297,39.7524,918.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="37.7524" x2="1087.5894" y1="918.4297" y2="918.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="49.7524" y="913.6875">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.4526" x="70.9038" y="913.6875">401 Unauthorized (DPoP-Nonce: &lt;new_nonce&gt;)</text></g><path d="M1093,899.1191 L1093,924.1191 L1423,924.1191 L1423,909.1191 L1413,899.1191 L1093,899.1191" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1413,899.1191 L1413,909.1191 L1423,909.1191 L1413,899.1191" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.9751" x="1099" y="916.6875">The DPoP fetch decorator handles the retry logic.</text><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="478.3193,946.7402,488.3193,950.7402,478.3193,954.7402,482.3193,950.7402" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="32.7524" x2="484.3193" y1="950.7402" y2="950.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="39.7524" y="945.998">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.377" x="60.9038" y="945.998">signProof(..., nonce=&lt;new_nonce&gt;) // RETRY</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="980.0508" y2="980.0508"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="980.0508" y2="993.0508"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="993.0508" y2="993.0508"/><polygon fill="#181818" points="511.3193,989.0508,501.3193,993.0508,511.3193,997.0508,507.3193,993.0508" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="507.3193" y="975.3086">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78.6919" x="528.4707" y="975.3086">retrieveKey()</text></g><g class="message" data-participant-1="S" data-participant-2="S"><line style="stroke:#181818;stroke-width:1;" x1="500.3193" x2="542.3193" y1="1022.3613" y2="1022.3613"/><line style="stroke:#181818;stroke-width:1;" x1="542.3193" x2="542.3193" y1="1022.3613" y2="1035.3613"/><line style="stroke:#181818;stroke-width:1;" x1="501.3193" x2="542.3193" y1="1035.3613" y2="1035.3613"/><polygon fill="#181818" points="511.3193,1031.3613,501.3193,1035.3613,511.3193,1039.3613,507.3193,1035.3613" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="507.3193" y="1017.6191">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258.1147" x="528.4707" y="1017.6191">createDPoPProof() ('nonce' claim present)</text></g><g class="message" data-participant-1="C" data-participant-2="RS_Res"><polygon fill="#181818" points="1076.5894,1075.9824,1086.5894,1079.9824,1076.5894,1083.9824,1080.5894,1079.9824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="32.7524" x2="1082.5894" y1="1079.9824" y2="1079.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="39.7524" y="1067.585">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285.5874" x="60.9038" y="1059.9297">GET /resource (Authorization: DPoP &lt;token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.5034" x="60.9038" y="1075.2402">DPoP: &lt;retry_proof&gt;)</text></g><g class="message" data-participant-1="RS_Res" data-participant-2="C"><polygon fill="#181818" points="48.7524,1105.293,38.7524,1109.293,48.7524,1113.293,44.7524,1109.293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.7524" x2="1087.5894" y1="1109.293" y2="1109.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="54.7524" y="1104.5508">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.3599" x="75.9038" y="1104.5508">200 OK</text></g><g class="message" data-participant-1="C" data-participant-2="S"><polygon fill="#181818" points="483.3193,1134.6035,493.3193,1138.6035,483.3193,1142.6035,487.3193,1138.6035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="32.7524" x2="489.3193" y1="1138.6035" y2="1138.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="39.7524" y="1133.8613">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.8413" x="60.9038" y="1133.8613">setNonce(htu, nonce) // Store new nonce</text></g><!--SRC=[jLLXRzem4FsUNt5YqaWaIkYqJmYGMCQghLL12TLKQH9opPLO2pPr76ZtwtUs0mMLTftMyGMu-DwzU-_ECS8K29ydQW8JhTGjdA54pOnG4fYSGvApea2vm9CKovMI9SANGcs2W76ZD2I5G6c0bP04AwQDu6B5A601Cx4WAFiiWrxlGd5Mm5TP6YOv3WR1ZRg7nh0okTBYbo-OeLvJHZZCeWQykn2Bt5nZOSi1VVRnf-edof6ShvJmvOVPpCK29D84xU69iweqnnro-eZygQZm2UusOHywpMOKtW47h39ALiiRmcjCsvr6qEzxFZ3aTvKeXUibl5JGP2PlWf1UsWZw_I18u6G0MHTAKiU5mwlqOZOTduykMp0PPzCMoAee8YkmM3D3t8EipbbfjHPpFCU7C8Bm34rSk-KTf7YqEyirKjo6VHMN8E7RTofWdMdLx7Z1n1AMeYo5N4IUtbRChYC4iN7TXGTcTVtGzDopmGzf_tMXjxB51b4mnpt-mHRGWYTT-D3fmFWSGiOvbkNCGRGSticbekaW76c_1tig98_AeHbBp79btE5mUnRYs0hjCX1S46vfHYNU6z1uLs5fzdab1rQUMXiftI0tEDyD0dbgEKAOLUv7_5Z1LN_9r7IKjU1iH8BNAXqrLQFH0jVUrIVHWqvTYmajORL4A6d_YAZhywzTVmzDbzYacSAILhXstizwrxA6M6yrUBtpi14cXwrvXqFWiGz6u1bxVRUvgLeUolMTsNx9p4tTyhDE4ctIvmzsxkwrE2Mb7_wNZKVys0f_RF7-LVwNDV_OEOKhoMemKYKyN3dSp8wiNI19HD3sodJNvJIltnUtQ7WES-IARY3QivpU5mKLCtJ0gl40XLe8tdOtfmKv9d2xtQvDxkyJi8Qdesbw_OPIlzcak-Pchn3yZOVyDm00]--></g></svg>